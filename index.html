<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <div class="body_wrap">
        <section class="header">
            <p class="big mb">AAAA AAA</p>
        </section>
        <section class="top_section">
            <article class="hero">
                <p class="medium sb label">aaaaa</p>
                <h2 class="animated_text">
                    <p>
                        <span>A</span>
                        <span>A</span>
                    </p>
                    <p>
                        <span>A</span>
                    </p>
                    <!-- <br/> -->
                    <p>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                    </p>
                    <!-- <br/> -->
                    <!-- <p>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                        <span>A</span>
                    </p> -->
                </h2>
            </article>
            <div class="top_img_box">
                <img src="" />
            </div>
        </section>
        <section class="name_section black">
            <img src="" class="name_img" />
        </section>
        <section class="job_section black">
            <article class="left">
                <p class="medium sb label">aaa</p>
                <h3 class="">AA AAA <br/>A A AAA</h3>
            </article>
            <article class="right">
                <ul>
                    <li>
                        <img src="" />
                        <div>
                            <p class="big bb">AAAA AA</p>
                            <p class="text n">aaaaaaa</p>
                        </div>
                    </li>
                    <li>
                        <img src="" />
                        <div>
                            <p class="big bb">AAA AAAAAAA</p>
                            <p class="text n">aaaaaaa</p>
                        </div>
                    </li>
                    <li>
                        <img src="" />
                        <div>
                            <p class="big bb">AAAAAAAAAA / AAAAAA</p>
                            <p class="text n">aaaaaaa</p>
                        </div>
                    </li>
                </ul>
            </article>
        </section>
        <section class="portfolio_section">
            <article class="title">
                <p class="medium sb label">aa aaaa aaa</p>
                <h3 class="flex_title">
                    <p><span>AAAA</span><span>AAAA</span><span>AAAA</span></p>
                    <p><span>AAAA</span><span>AAA</span><span>AAAA</span></p>
                </h3>
            </article>
            <article class="bottom">
                <ul class="project_list ">
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">01</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">02</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                </ul>
                <ul class="project_list ">
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">01</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">02</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">02</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                </ul>
                <ul class="project_list ">
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">01</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">02</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                    <li>
                        <a class="trigger_btn" href=""></a>
                        <div class="thumbnail_box">
                            <img src="" class="thumbnail" />
                        </div>
                        <div class="description_box">
                            <p class="medium mb">02</p>
                            <p class="big bb">AAAAA</p>
                        </div>
                        <div class="contribution_box">
                            <div>
                                <p class="medium mb">AAA</p>
                                <h3>80%</h3>
                                <p class="text n">AAAA</p>
                            </div>
                            <div class="use_skills">
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                                <img src="" class="skill_icon" />
                            </div>
                        </div>
                    </li>
                </ul>
            </article>
        </section>
        <section class="skill_section" style="height: 100dvh;"></section>
    </div>
  <!-- <section class="hero">
    <h1 class="animated_text">
      <span>I</span>
      <span>'</span>
      <span>M</span>
      <span>A</span>
      <br/>
      <span>W</span>
      <span>E</span>
      <span>B</span>
      <br/>
      <span>P</span>
      <span>U</span>
      <span>B</span>
      <span>L</span>
      <span>I</span>
      <span>S</span>
      <span>H</span>
      <span>E</span>
      <span>R</span>
    </h1>
  </section> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/SplitText.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const animatedText = document.querySelector('.animated_text');
    const spans = animatedText.querySelectorAll('span');
    const hero = document.querySelector('.hero');
    const labels = document.querySelectorAll('.label');
    const projectLists = document.querySelectorAll('.project_list'); // 🎯 모든 .project_list 선택
    const article = document.querySelector('article'); // 🎯 article 요소 선택

    let firstEntry = true;
    let currentTween = null; // 🔥 현재 실행 중인 gsap.to()를 추적

    // 초기 위치 세팅
    gsap.set(spans, { opacity: 0, y: 0 });
    gsap.set(labels, { opacity: 0, y: 20 }); // 살짝 아래에서 시작
    gsap.set(projectLists, { xPercent: 100, position: "relative" }); // 🎯 화면 밖 오른쪽으로 밀어놓기

    // Intersection Observer 생성 (하나만 사용!)
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const target = entry.target;

            if (entry.isIntersecting) {
                if (target === hero) {
                    // ✅ 등장 애니메이션 실행 전에 확실히 초기화
                    gsap.killTweensOf(spans); // 실행 중 애니메이션 중지
                    gsap.set(spans, { opacity: 0, y: 0 });

                    // 💡 살짝 시간차 두고 등장 애니메이션
                    const delay = firstEntry ? 500 : 100;
                    setTimeout(() => {
                        gsap.killTweensOf(spans); // 혹시 모를 중복 제거
                        gsap.set(spans, { opacity: 0, y: 0 }); // 다시 초기화 (완전 클린!)

                        currentTween = gsap.to(spans, {
                            delay: 0,
                            duration: 1.5,
                            opacity: 1,
                            y: 0,
                            stagger: 0.1,
                            ease: "power3.out",
                        });
                    }, delay);

                    firstEntry = false;

                    // 떨어지는 애니메이션은 3초 후 실행
                    setTimeout(() => {
                        const heroRect = hero.getBoundingClientRect();
                        const heroBottom = heroRect.bottom + window.scrollY;
                        const heroHeight = heroRect.height;

                        const minDropY = 0;
                        const maxDropY = heroBottom - heroHeight;

                        // 애니메이션 실행
                        // spans.forEach(span => {
                        //     gsap.to(span, {
                        //         duration: 2.5,
                        //         y: gsap.utils.random(minDropY - span.offsetTop, maxDropY - span.offsetTop),
                        //         x: gsap.utils.random(0, 0),
                        //         opacity: 1, // ✨ 페이드아웃 막기 위해 명시적으로 유지
                        //         ease: "bounce.out",
                        //         overwrite: true,
                        //     });
                        // });
                    }, delay);
                }

                // 👇 .label 요소 처리
                if (target.classList.contains('label')) {
                    // gsap 등장 애니메이션
                    gsap.fromTo(target,
                        {
                            opacity: 0,
                            y: 20
                        },
                        {
                            opacity: 1,
                            y: 0,
                            duration: 1,
                            ease: "power3.out",
                            overwrite: true
                        }
                    );
                }

                // 👇 article 영역이 뷰포트에 들어오면 모든 .project_list 슬라이드 애니메이션 실행
                if (target === article) {
                    projectLists.forEach(list => {
                        // 이미 'animated' 클래스가 있으면 퇴장 애니메이션 실행
                        if (list.classList.contains('animated')) {
                            gsap.to(list,
                                {
                                    xPercent: 100, // 화면 오른쪽으로 슬라이드
                                    duration: 1.2,
                                    ease: "power3.in",
                                    overwrite: true,
                                    onComplete: () => {
                                        list.classList.remove('animated'); // 애니메이션 완료 후 'animated' 클래스 제거
                                    }
                                }
                            );
                        }
                    });
                }

            } else {
                // 👇 article 영역이 뷰포트 밖으로 나가면 모든 .project_list 슬라이드 애니메이션 퇴장
                if (target === article) {
                    projectLists.forEach(list => {
                        // 이미 애니메이션이 실행된 요소는 다시 실행하지 않음
                        if (!list.classList.contains('animated')) {
                            gsap.fromTo(list,
                                {
                                    xPercent: 100 // 화면 오른쪽 밖에서 시작
                                },
                                {
                                    xPercent: 0, // 왼쪽으로 슬라이드
                                    duration: 1.2,
                                    ease: "power3.out",
                                    overwrite: true,
                                    onComplete: () => {
                                        list.classList.add('animated'); // 애니메이션 완료 후 'animated' 클래스 추가
                                    }
                                }
                            );
                        }
                    });
                }
            }
        });
    }, {
        threshold: 0.1 // 30% 이상 보일 때 실행
    });

    // 관찰 시작
    observer.observe(hero);
    labels.forEach(label => observer.observe(label));
    observer.observe(article); // 🎯 article을 관찰하여 bottom이 뷰포트에 들어올 때 애니메이션 실행
});

    </script>
</body>
</html>